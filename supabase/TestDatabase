æµ‹è¯•æ–°æ•°æ®åº“ã€‚è¯·åœ¨ SQL Editor ä¸­ä¾æ¬¡è¿è¡Œä»¥ä¸‹æµ‹è¯•æŸ¥è¯¢ï¼š

  ğŸ“Š æµ‹è¯• 1ï¼šæ£€æŸ¥æ‰€æœ‰è¡¨

  -- æŸ¥çœ‹æ‰€æœ‰åˆ›å»ºçš„è¡¨
  SELECT tablename
  FROM pg_tables
  WHERE schemaname = 'public'
  ORDER BY tablename;

  æœŸæœ›ç»“æœï¼šåº”è¯¥çœ‹åˆ° 7 ä¸ªè¡¨
  - families
  - levels
  - quests
  - redemptions
  - rewards
  - star_transactions
  - users

  ---
  ğŸ” æµ‹è¯• 2ï¼šéªŒè¯ quests è¡¨çš„æ–°å­—æ®µ

  -- æ£€æŸ¥ quests è¡¨ç»“æ„ï¼ˆé‡ç‚¹çœ‹æ–°å­—æ®µï¼‰
  SELECT
    column_name,
    data_type,
    column_default,
    is_nullable
  FROM information_schema.columns
  WHERE table_name = 'quests'
  AND column_name IN ('type', 'scope', 'max_per_day', 'category')
  ORDER BY column_name;

  æœŸæœ›ç»“æœï¼š
  - category | text | NULL | YES
  - max_per_day | integer | 1 | YES
  - scope | text | 'self'::text | NO
  - type | text | 'bonus'::text | NO

  ---
  âœ… æµ‹è¯• 3ï¼šæ£€æŸ¥çº¦æŸ

  -- æŸ¥çœ‹ type å­—æ®µçš„çº¦æŸ
  SELECT
    con.conname AS constraint_name,
    pg_get_constraintdef(con.oid) AS constraint_definition
  FROM pg_constraint con
  JOIN pg_class rel ON rel.oid = con.conrelid
  WHERE rel.relname = 'quests'
  AND con.conname LIKE '%type%';

  æœŸæœ›ç»“æœï¼šåº”è¯¥çœ‹åˆ° CHECK çº¦æŸï¼Œé™åˆ¶ type åªèƒ½æ˜¯ 'duty', 'bonus', 'violation'

  ---
  ğŸ¯ æµ‹è¯• 4ï¼šæ£€æŸ¥å‡½æ•°æ˜¯å¦åˆ›å»ºæˆåŠŸ

  -- æŸ¥çœ‹åˆ›å»ºçš„å‡½æ•°
  SELECT
    routine_name,
    routine_type
  FROM information_schema.routines
  WHERE routine_schema = 'public'
  AND routine_name IN ('initialize_family_templates', 'create_family_with_templates')
  ORDER BY routine_name;

  æœŸæœ›ç»“æœï¼š
  - create_family_with_templates | FUNCTION
  - initialize_family_templates | FUNCTION

  ---
  ğŸ›¡ï¸ æµ‹è¯• 5ï¼šæ£€æŸ¥ RLS ç­–ç•¥

  -- æŸ¥çœ‹ Row Level Security æ˜¯å¦å¯ç”¨
  SELECT
    schemaname,
    tablename,
    rowsecurity
  FROM pg_tables
  WHERE schemaname = 'public'
  ORDER BY tablename;

  æœŸæœ›ç»“æœï¼šæ‰€æœ‰è¡¨çš„ rowsecurity éƒ½åº”è¯¥æ˜¯ t (true)

  ---
  ğŸ‘ï¸ æµ‹è¯• 6ï¼šæ£€æŸ¥è§†å›¾

  -- æŸ¥çœ‹è§†å›¾
  SELECT
    table_name,
    view_definition
  FROM information_schema.views
  WHERE table_schema = 'public';

  æœŸæœ›ç»“æœï¼šåº”è¯¥çœ‹åˆ° child_balances è§†å›¾

  ---
  ğŸ“¦ å®Œæ•´æ€§æµ‹è¯•ï¼šæ¨¡æ‹Ÿåˆ›å»ºå®¶åº­

  ç°åœ¨æœ€é‡è¦çš„æµ‹è¯• - éªŒè¯æ¨¡æ¿å‡½æ•°æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼

  ä¸è¦ç›´æ¥è¿è¡Œè¿™ä¸ªï¼Œè¿™åªæ˜¯ç¤ºä¾‹ï¼ˆæ‚¨çš„åº”ç”¨ä¼šåœ¨æ³¨å†Œæ—¶è‡ªåŠ¨è°ƒç”¨ï¼‰ï¼š

  -- è¿™æ˜¯ç¤ºä¾‹ï¼Œæ˜¾ç¤ºæ³¨å†Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ
  -- å®é™…åº”è¯¥é€šè¿‡åº”ç”¨æ³¨å†Œæ¥æµ‹è¯•

  -- SELECT create_family_with_templates(
  --   'Test Family',
  --   'your-auth-user-id-here'::uuid,
  --   'Test Parent',
  --   'test@example.com',
  --   'en'
  -- );

  ---